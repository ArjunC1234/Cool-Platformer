<!DOCTYPE html>
<html>
  <head>
    <title>socketio temp made from easy chat cuz i couldnt figure it out</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
    </style>
  </head>
  <body>
    <!--TYPE HTML HERE-->
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var users = []
      function generate(n) {
        var add = 1, max = 12 - add;   // 12 is the min safe number Math.random() can generate without it starting to pad the end with zeros.   

        if ( n > max ) {
                return generate(max) + generate(n - max);
        }

        max        = Math.pow(10, n+add);
        var min    = max/10; // Math.pow(10, n) basically
        var number = Math.floor( Math.random() * (max - min + 1) ) + min;

        return ("" + number).substring(add); 
      }
      var id = generate(20).toString()
      function Corcle(id) {
        this.id = id
        let ele = document.createElement("div")
        ele.style = "position: absolute; left: 100px; top: 100px; width : 100px; height : 100px; border-radius: 25px; background-color: yellow;"
        ele.id = id
        document.body.appendChild(ele)
        this.ele = document.getElementById(id)
      }
      var socket = io();
      socket.emit("c", id)
      //type js here
      socket.on("c", function(userid, socket) {
        users.push(new Corcle(userid, socket))
        if (userid == id) {
          socket.emit("getOthers", id)
          console.log("getOthers")
        }
      })
      socket.on()
      socket.on("getOthers", function(userid) {
        if (userid != id) {
          let ele = document.getElementById(id)
          socket.emit("sendOthers", userid, socket, id, ele.style.left, ele.style.top)
        }
      })
      socket.on("sendOthers", function(idTo, socket, idFrom, left, top) {
        if (id == idTo) {
          users.push(new Corcle(idFrom))
          let ele = document.getElementById(idFrom)
          ele.style.left = left
          ele.style.top = top
          console.log("Received.")
        }
      })
      socket.on("move", function(userid, left, top) {
        for (var i = 0; i < users.length; i++) {
          if (users[i].id == userid) {
            let ele = document.getElementById(userid)
            let leftele = (parseInt(ele.style.left.split("px")[0]) + parseInt(left)).toString() + "px"
            let topele = (parseInt(ele.style.top.split("px")[0]) + parseInt(top)).toString() + "px"
            ele.style.left = leftele
            ele.style.top = topele
          }
        }
      })
      var w = false
      var s = false
      var a = false
      var d = false
      window.addEventListener("keydown", function (e) {
        if (e.key == "w") {
          w = true
        }
        if (e.key == "s") {
          s = true
        }
        if (e.key == "a") {
          a = true
        }
        if (e.key == "d") {
          d = true
        }
      })
      window.addEventListener("keyup", function (e) {
        if (e.key == "w") {
          w = false
        }
        if (e.key == "s") {
          s = false
        }
        if (e.key == "a") {
          a = false
        }
        if (e.key == "d") {
          d = false
        }
      })
      setInterval(function() {
        if (w) {
          socket.emit('move', id, '0', '-1')
        }
        if (s) {
          socket.emit('move', id, '0', '1')
        }
        if (a) {
          socket.emit('move', id, '-1', '0')
        }
        if (d) {
          socket.emit('move', id, '1', '0')
        }
      }, 10)
    </script>
  </body>
</html>