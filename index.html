<!DOCTYPE html>
<html>
  <head>
    <title>socketio temp made from easy chat cuz i couldnt figure it out</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      h1 {
        font-family : "Verdana";
        font-size : 30px;
        width : max-content;
      }
      input {
        width : 400px;
        height : 30px;
        font-size : 20px;
      }
      #user {
        width : 100px;
      }
      .other {
        color : black;
        background-color : lightgray;
      }
      .me {
        color : white;
        background-color : blue;
      }
      p {
        padding:5px;
        padding-left : 8px;
        padding-right : 8px;
        font-family: cursive;
        border-radius : 5px;
        margin:5px;
        max-width : 300px;
        min-width : 75px;
      }
      name {
        position : relative;
        top : -8px;
        left : 7px;
        font-size : 17px;
        color : gray;
      }
      .msg {
        margin-bottom : -2px;
        float : left;
      }
      .msgown {
        margin-bottom : -2px;
        float : right;
      }
      .logs {
        display : flex;
        flex-direction : column;
        flex-width : 100%;
        width : 700px;
        height : 600px;
        overflow-y : scroll;
        border: 3px solid black;
      }
    </style>
  </head>
  <body>
    <!--TYPE HTML HERE-->
    <h1 id="title">
      Welcome to my first chat room in socket.io
    </h1>
    <input type="text" id="user" placeholder="type name here" maxlength="12">
    <input type="text" id="chatinput" placeholder="type text here">
    <div class="logs" id="chatlog"></div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        function notifyMe(name) {
         if (Notification.permission !== 'granted')
          Notification.requestPermission();
         else {
          var notification = new Notification('New Message! (chatroom)', {
           body: name
          });
          notification.onclick = function() {
           window.open('http://mychatroom.glitch.me', '_blank').focus();
          };
         }
        }
      function generate(n) {
        var add = 1, max = 12 - add;   // 12 is the min safe number Math.random() can generate without it starting to pad the end with zeros.   
        
        if ( n > max ) {
                return generate(max) + generate(n - max);
        }
        
        max        = Math.pow(10, n+add);
        var min    = max/10; // Math.pow(10, n) basically
        var number = Math.floor( Math.random() * (max - min + 1) ) + min;
        
        return ("" + number).substring(add); 
      }
      var id = generate(20)
      var socket = io();
      //type js here
      document.getElementById("chatinput").addEventListener("keyup", function (e) {
        console.log("pressed")
        if (e.key == "Enter" && document.getElementById("chatinput").value.trim() != '' && document.getElementById("user").value.trim() != '') {
          let msg = document.getElementById("chatinput").value
          let name = document.getElementById("user").value
          socket.emit("chat message", name, msg, id)
          document.getElementById("chatinput").value = ''
        }
      })
      document.addEventListener('DOMContentLoaded', function() {
        if (!Notification) {
        alert('Desktop notifications not available in your browser. Try Chromium.');
        return;
        }

        if (Notification.permission !== 'granted')
        Notification.requestPermission();
      });
      socket.on("chat message", function(name, msg, userid) {
        let ele = document.createElement("p")
        let div = document.createElement("div")
        let nameele = document.createElement("name")
        div.style.innerText = userid
        div.className = "msg"
        if (userid == id) {
          ele.className = "me"
          div.style.float = "right"
        } else {
          ele.className = "other"
        }
        ele.innerHTML = msg
        nameele.innerHTML = name
        div.appendChild(ele)
        div.appendChild(nameele)
        if (!(document.getElementById("chatlog").childNodes.length === 0)) {
          let lastmsg = document.getElementById("chatlog").lastElementChild;
          if (lastmsg.style.innerText == userid) {
            lastmsg.className = "msgown"
            lastmsg.lastElementChild.remove()
          }
        }
        
        document.getElementById("chatlog").appendChild(div)
        // request permission on page load
        if (!document.hasFocus()) {
          notifyMe()
        }
      })
    </script>
  </body>
</html>
