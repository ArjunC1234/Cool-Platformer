<!DOCTYPE html>
<html>
  <head>
    <title>Tim Markle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <!--TYPE HTML HERE-->
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
      function Corcle(id, color, displayName) {
        let ele = document.createElement("div")
        ele.style = `position: absolute; left: 100px; top: 100px; width : 100px; height : 100px; border-radius: 0px; background-color: ${color};`
        ele.id = id
        ele.innerHTML = displayName
        document.body.appendChild(ele)
      }
      var socket = io();
      var client_users = []
      socket.on("connect", function () {
        socket.emit("user joined")
      })
      socket.on("disconnect", () => {
        socket.emit("user left"); // undefined
      });
      socket.on("user joined", function (id, users) {
        client_users = users
        if (id == socket.id) {
          for (var i = 0; i < client_users.length; i++) {
            Corcle(client_users[i].id, client_users[i].data.color, client_users[i].displayName)
          }
        } else {
          for (var i = 0; i < client_users.length; i++) {
            if (client_users[i].id == id) {
              Corcle(client_users[i].id, client_users[i].data.color, client_users[i].displayName)
            }
          }
        }
      })
      socket.on("user left", function (id, users) {
        client_users = users
        document.getElementById(id).remove()
      })
      socket.on("updateGame", function (users) {
        if (users.length > 0) {
          var client_users = users
          for (var i = 0; i < client_users.length; i++) {
            let user = client_users[i]
            document.getElementById(user.id).style.left = user.data.x + "px"
            document.getElementById(user.id).style.top = user.data.y + "px"
          }
        }
      })
      var w = false
      var s = false
      var a = false
      var d = false
      window.addEventListener("keydown", function (e) {
        if (e.key == "w") {
          w = true
        }
        if (e.key == "s") {
          s = true
        }
        if (e.key == "a") {
          a = true
        }
        if (e.key == "d") {
          d = true
        }
      })
      window.addEventListener("keyup", function (e) {
        if (e.key == "w") {
          w = false
        }
        if (e.key == "s") {
          s = false
        }
        if (e.key == "a") {
          a = false
        }
        if (e.key == "d") {
          d = false
        }
      })
      setInterval(function () {
        if (w) {
          socket.emit('updateUser', "y", -3)
        }
        if (s) {
          socket.emit('updateUser', "y", 3)
        }
        if (a) {
          socket.emit('updateUser', "x", -3)
        }
        if (d) {
          socket.emit('updateUser', "x", 3)
        }
      }, 2
    </script>
  </body>
</html>