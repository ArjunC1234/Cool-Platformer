<!DOCTYPE html>
<html>
  <head>
    <title>Tim Markle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      .home {
        background-image : url('https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/New%20Piskel-1.png%20(13).png?v=1667177262304'); 
        background-repeat : no-repeat; 
        background-size : cover; 
        width : 108px; 
        height : 108px; 
        position : absolute; 
        left : 10px; 
        top : 10px; 
        opacity : 0.5;
      }
      .home:hover {
        opacity : 1;
      }
      .home:active {
        opacity : 0.5
      }
    </style>
  </head>
  <body style="padding: 0; margin: 0; width: 100%; height: 100%; overflow: hidden">
    <!--TYPE HTML HERE-->
    <canvas id="gameCanv"></canvas>
    <div class= "home" onclick="window.location.pathname = '/'"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io()
      var client_users = []
      socket.on("connect", function () {
        socket.emit("user joined", window.location.pathname)
      })
      socket.on("user joined", function (id, path) {
        if (id != socket.id && path == window.location.pathname) {
          client_users.push({id: id, x : 0, y : 0, legr : 0, right : true})
          socket.emit("send players", player.x, player.y, legrotation, right, id, window.location.pathname)
        }
      })
      socket.on("send players", function (client_id, x, y, legr, r, id, path) {
        if (id == socket.id && path == window.location.pathname) {
          client_users.push({id: client_id, x : x, y : y, legr : legr, right : r})
        }
      })
      socket.on("user left", function (id, path) {
        if (path == window.location.pathname){
          for (var i = 0; i < client_users.length; i++) {
            if (client_users[i].id == id) {
              client_users.splice(i, 1)
            }
          }
        }
      })
      socket.on("update", function (id, x, y, legr, r, path) {
        if (path == window.location.pathname) {
          for (var i = 0; i < client_users.length; i++) {
            if (client_users[i].id == id) {
              client_users[i].x = x
              client_users[i].y = y
              client_users[i].legr = legr
              client_users[i].right = r
            }
          }
        }
      })
      var disp = document.getElementById("gameCanv");
      var dtx = disp.getContext("2d");
      var canvas = document.createElement("canvas");
      var ctx = canvas.getContext("2d");
      var gravite = 0;
      var gravacc = 1.5;
      var gravcap = 8;
      var legrotation = 0;
      var legtick = 0;
      var dispNum = 1;
      var jumpacc = 0.4;
      var jumpaccog = jumpacc
      var jumpSpeed = 6;
      var jumpcap = 0.4;
      var finish = new Image();
      finish.src =
        "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/finish?v=1667116674850";
      var winds = [new Image(), new Image(), new Image(), new Image()];
      winds[0].src =
        "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/wind1?v=1667116669754";
      winds[1].src = "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/wind2?v=1667116671677";
      winds[2].src =
        "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/wind3?v=1667116672474";
      winds[3].src = "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/wind2?v=1667116671677";
      var windimg = winds[0];
      var windite = 0;
      var windtick = 0;
      var gravSpeed = jumpcap;
      var ogGravSpeed = gravSpeed;
      var ogJumpSpeed = jumpSpeed;
      var jumpiter = 0;
      var reverseGravity = false;
      var jumpground = false;
      var jumpKind = 1;
      var centercam = false;
      var movingY = false;
      var movingX = false;
      var legCap = false;
      var jumpHold = 0;
      var jumpHoldMax = 16;
      var jumpimg = new Image();
      jumpimg.src =
        "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/jumpBlock?v=1667116670746";
      disp.width = window.innerWidth * (5 / 8);
      disp.height = window.innerHeight;
      var graviter = 0;
      var grass = new Image();
      grass.src =
        "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/grass?v=1667116667374";
      var dirt = new Image();
      dirt.src =
        "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/dirt?v=1667116668761";
      var sign = new Image()
      sign.src = "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/New%20Piskel-1.png%20(12).png?v=1667169813449"
      var bigJumpList = [];
      var right = true;
      var tm = [
      // 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1], //0
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1], //1
        [1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1], //2
        [1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1], //3
        [1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1], //4
        [1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1], //5
        [1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 2, 0, 1, 1, 0, 0, 0, 0, 0, 1], //6
        [1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1], //7
        [1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 3, 3, 3, 3, 3, 3, 1, 1, 0, 0, 0, 0, 1, 1], //8
        [1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1], //9
        [1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 1, 1, 1], //10
        [1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 1, 1, 1], //11
        [1, 6, 0, 0, 0, 0, 1, 5, 0, 0, 4, 4, 4, 4, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1], //12
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1]  //13
      ];
      addSign(4, 12, 'Welcome to the tutorial. I see you\'ve figured out moving. To get past this first jump, short tap "W" or "â¬†".')
      addSign(7, 10, 'Good Job! Now do the same thing except this time, hold the button down. This makes you jump higher.')
      addSign(6, 1, "Nice work getting up here! The green arrow ahead allows you to jump for a 2nd time when you are over it.")
      addSign(9, 3, "BEWARE: The salmon red blocks kill you!!!! They WILL reset you.")
      addSign(16, 11, "Great! These next tiles are called slipstreams. They multiply your speed by 2. Get to the other side.")
      addSign(9, 12, "YOU DID IT!!! The checkered tile ahead is the finish line. Go walk into it and your done!")
      function addSign(x, y, text) {
        if (x >= 0 && x < tm[0].length && y >= 0 && y < tm.length) {
          if (tm[y][x] == 0) {
            tm[y][x] = {type : 7, text : text}
          }
        }
      }
      function getLines(ctx, text, maxWidth) {
        var words = text.split(" ");
        var lines = [];
        var currentLine = words[0];

        for (var i = 1; i < words.length; i++) {
          var word = words[i];
          var width = ctx.measureText(currentLine + " " + word).width;
          if (width < maxWidth) {
            currentLine += " " + word;
          } else {
            lines.push(currentLine);
            currentLine = word;
          }
        }
        lines.push(currentLine);
        return lines;
      }
      function checkSign(){
        for (var y = 0; y < tm.length; y++) {
          for (var x = 0; x < tm[y].length; x++) {
            if (
              typeof tm[y][x] === "object" &&
              y * 48 >= player.y - 96 + player.height/2 &&
              y * 48 <= player.y + 96 + player.height/2 &&
              (x * 48 >= player.x - 96 + player.width/2 || x * 48 <= player.x + player.width/2 + 96)
            ) {
              if (tm[y][x].type == 7) {
                let tile = {
                  x: x * 48,
                  y: y * 48,
                  type: 7,
                };
                signhover.active = false
                if (!(player.x + player.width/2 > tile.x + 48) && !(player.x + player.width/2 < tile.x)) {
                  if (
                    !(player.y + player.height/2 > tile.y + 48) &&
                    !(player.y + player.height/2 < tile.y)
                  ) {
                    signhover.active = true
                    signhover.text = tm[y][x].text
                    return
                  }
                }
              }
            }
          }
        }
      }
      /*
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 3, 5, 5, 5],
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 4, 4, 4, 3, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 4, 4, 4, 3, 0, 0, 0],
      [0, 1, 0, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 4, 4, 4, 4, 0, 3, 0],
      [1, 0, 0, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 3, 3, 3, 4, 3, 0, 2, 0],
      [0, 0, 0, 3, 0, 3, 0, 0, 0, 3, 0, 0, 0, 0, 1, 3, 3, 1, 3, 3, 3, 0, 3, 0],
      [0, 1, 0, 3, 0, 0, 0, 3, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 3, 0],
      [0, 0, 0, 3, 0, 3, 3, 0, 0, 3, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 0, 3, 0],
      [1, 0, 0, 3, 0, 0, 0, 0, 3, 3, 0, 0, 3, 3, 3, 3, 0, 3, 2, 0, 3, 0, 3, 2],
      [0, 0, 0, 3, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 3, 0, 0, 0],
      [0, 1, 0, 3, 0, 0, 0, 3, 0, 3, 1, 1, 1, 1, 1, 1, 1, 1, 3, 0, 3, 0, 0, 0],
      [0, 0, 0, 3, 3, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 4, 0, 0],
      [1, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 3, 0, 0, 4, 4, 0, 3, 3, 2, 0],
      [0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 3, 3, 0, 0],
      [0, 1, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 3, 0, 0],
      [6, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 3, 0, 0],
      [1, 1, 1, 3, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 3, 3, 3, 3],
      [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3]
      
      
[
        [0, 0, 0, 0, 3, 0, 0, 3, 0, 0, 0, 0, 0, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 3, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 3, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 3, 0, 0, 0, 0, 2, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 6, 0, 0, 3, 0, 0, 3, 3, 3, 3, 3, 1, 3, 3, 3, 3, 3, 1, 0, 0, 0, 0, 0, 0],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0],
        [5, 0, 3, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [5, 0, 3, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 4, 4, 4, 4, 0, 0, 0],
        [5, 0, 3, 0, 1, 1, 1, 1, 3, 0, 1, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0],
        [1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1, 0, 2, 0, 1, 1, 1, 1, 0, 1, 0, 2, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1],
        [1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1, 3, 3, 3, 1, 1, 1, 1, 3, 1, 3, 3, 3, 3, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3]
      */
      var key = false;
      var signhover = {active : true, text : ""}
      function collision() {
        let oneTimeJumpBlock = true;
        let oneTimeSpeedBlock = true;
        for (var y = 0; y < tm.length; y++) {
          for (var x = 0; x < tm[y].length; x++) {
            if (
              tm[y][x] == 2 &&
              y * 48 >= player.y - 96 + player.height/2 &&
              y * 48 <= player.y + 96 + player.height/2 &&
              (x * 48 >= player.x - 96 + player.width/2 || x * 48 <= player.x + player.width/2 + 96) &&
              oneTimeJumpBlock
            ) {
              let tile = {
                x: x * 48,
                y: y * 48,
                type: 2,
              };
              jumpBlock = false;
              if (
                !(player.x > tile.x + (player.width - 1)) &&
                !(player.x + player.width < tile.x + 1)
              ) {
                if (
                  !(player.y > tile.y + 47) &&
                  !(player.y + player.height < tile.y + 1)
                ) {
                  jumpBlock = true;
                  oneTimeJumpBlock = false;
                }
              }
            }
            if (
              tm[y][x] == 3 &&
              y * 48 >= player.y - 96 + player.height/2 &&
              y * 48 <= player.y + 96 + player.height/2 &&
              (x * 48 >= player.x - 96 + player.width/2 || x * 48 <= player.x + player.width/2 + 96)
            ) {
              let tile = {
                x: x * 48,
                y: y * 48,
                type: 3,
              };
              if (!(player.x + player.width/2 > tile.x + 48) && !(player.x + player.width/2 < tile.x)) {
                if (
                  !(player.y + player.height/2 > tile.y + 48) &&
                  !(player.y + player.height/2 < tile.y)
                ) {
                  going.up = false;
                  jumping = false;
                  jumpSpeed = ogJumpSpeed;
                  gravSpeed = ogGravSpeed;
                  going.down = false;
                  jumpBlock = false;
                  going.right = false;
                  going.left = false;
                  alert("YOU DIED!!!");
                  player.x = playerxstart;
                  player.y = playerystart;
                }
              }
            }
            if (
              tm[y][x] == 4 &&
              y * 48 >= player.y - 96 + player.height/2 &&
              y * 48 <= player.y + 96 + player.height/2 &&
              (x * 48 >= player.x - 96 + player.width/2 || x * 48 <= player.x + player.width/2 + 96) &&
              oneTimeSpeedBlock
            ) {
              let tile = {
                x: x * 48,
                y: y * 48,
                type: 4,
              };
              speed = 4;
              if (
                !(player.x + player.width/2 >= tile.x + 48) &&
                !(player.x + player.width/2 <= tile.x)
              ) {
                if (
                  !(player.y + player.height/2 >= tile.y + 48) &&
                  !(player.y + player.height/2 <= tile.y)
                ) {
                  speed = 8;
                  oneTimeSpeedBlock = false;
                }
              }
            }
            if (
              tm[y][x] == 5 &&
              y * 48 >= player.y - 96 + player.height/2 &&
              y * 48 <= player.y + 96 + player.height/2 &&
              (x * 48 >= player.x - 96 + player.width/2 || x * 48 <= player.x + player.width/2 + 96)
            ) {
              let tile = {
                x: x * 48,
                y: y * 48,
                type: 5,
              };
              if (
                !(player.x + player.width/2 >= tile.x + 48) &&
                !(player.x + player.width/2 <= tile.x)
              ) {
                if (
                  !(player.y + player.height/2 > tile.y + 48) &&
                  !(player.y + player.height/2 < tile.y)
                ) {
                  going.up = false;
                  jumping = false;
                  going.down = false;
                  jumpBlock = false;
                  going.right = false;
                  going.left = false;
                  jumpSpeed = ogJumpSpeed;
                  gravSpeed = ogGravSpeed;
                  alert("GOOD JOB!!! NOW DO IT AGAIN!!!");
                  player.x = playerxstart;
                  player.y = playerystart;
                }
              }
            }

            if (
              tm[y][x] == 1 &&
              y * 48 >= player.y - 96 + player.height/2 &&
              y * 48 <= player.y + 96 + player.height/2 &&
              (x * 48 >= player.x - 96 + player.width/2 || x * 48 <= player.x + player.width/2 + 96)
            ) {
              let tile = {
                x: x * 48,
                y: y * 48,
                type: 1,
              };
              if (
                !(player.x > tile.x + 47) &&
                !(player.x + player.width < tile.x + 1)
              ) {
                if (
                  !(player.y > tile.y + 47) &&
                  !(player.y + player.height < tile.y + 1)
                ) {
                  return [true, tile];
                }
              }
            }
          }
        }
        return [false];
      }
      function mirrorImage(
        image,
        x = 0,
        y = 0,
        horizontal = false,
        vertical = false
      ) {
        ctx.save(); // save the current canvas state
        ctx.setTransform(
          horizontal ? -1 : 1,
          0, // set the direction of x axis
          0,
          vertical ? -1 : 1, // set the direction of y axis
          x + (horizontal ? image.width : 0), // set the x origin
          y + (vertical ? image.height : 0) // set the y origin
        );
        ctx.drawImage(image, 0, 0);
        ctx.restore(); // restore the state as it was when this function was called
      }
      CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
        if (w < 2 * r) r = w / 2;
        if (h < 2 * r) r = h / 2;
        this.beginPath();
        this.moveTo(x + r, y);
        this.arcTo(x + w, y, x + w, y + h, r);
        this.arcTo(x + w, y + h, x, y + h, r);
        this.arcTo(x, y + h, x, y, r);
        this.arcTo(x, y, x + w, y, r);
        this.closePath();
        return this;
      };
      var jumpsustain = false
      var onGround = false;
      var going = {
        up: false,
        left: false,
        down: false,
        right: false,
      };
      var wasGoing = {
        up: going.up,
        down: going.down,
        left: going.left,
        right: going.right,
      };
      window.onkeydown = function (e) {
        if (e.keyCode == 38) {
          going.up = true;
        }
        if (e.keyCode == 37) {
          going.left = true;
        }
        if (e.keyCode == 40) {
          going.down = true;
        }
        if (e.keyCode == 39) {
          going.right = true;
        }
        if (e.keyCode == 87) {
          going.up = true;
        }
        if (e.keyCode == 65) {
          going.left = true;
        }
        if (e.keyCode == 83) {
          going.down = true;
        }
        if (e.keyCode == 68) {
          going.right = true;
        }
        if (e.keyCode == 32) {
          key = true;
        }
      };
      window.onkeyup = function (e) {
        if (e.keyCode == 87) {
          going.up = false;
        }
        if (e.keyCode == 65) {
          going.left = false;
        }
        if (e.keyCode == 83) {
          going.down = false;
        }
        if (e.keyCode == 68) {
          going.right = false;
        }
        if (e.keyCode == 38) {
          going.up = false;
          e.preventDefault();
        }
        if (e.keyCode == 37) {
          going.left = false;
          e.preventDefault();
        }
        if (e.keyCode == 39) {
          going.right = false;
          e.preventDefault();
        }
        if (e.keyCode == 40) {
          going.down = false;
          e.preventDefault();
        }
        if (e.keyCode == 32) {
          key = false;
        }
      };
      function devTools(password = "") {
        try {
          document.getElementById("devtools").remove();
          dispNum = 1;
          return "'Developer Tools' has been hidden.";
        } catch (err) {
          if (password == "dev123") {
            dispNum = 8 / 10;
            let interface = document.createElement("div");
            interface.id = "devtools";
            interface.style =
              "position : absolute; top : 0; height : 100vh; width : 20vw; background-color : black; float:right; right : 0px; overflow-y : scroll; overflow-x: wrap;";
            let tmInput = document.createElement("textarea");
            tmInput.style = "overflow: scroll; overflow-x : scroll;";
            tmInput.backgroundColor = "black";
            tmInput.fontFamily = "Verdana";
            tmInput.style =
              "white-space: pre; overflow-wrap: normal; overflow-x: scroll;";
            let str = "";
            for (var i = 0; i < tm.length; i++) {
              let strpush = "[";
              for (var x = 0; x < tm[i].length; x++) {
                strpush += tm[i][x];
                if (x != tm[i].length - 1) {
                  strpush += ", ";
                }
              }
              strpush += "]";
              if (i != tm.length - 1) {
                strpush += ", \r\n";
              } else {
                strpush += "\r\n";
              }

              str += strpush;
            }
            tmInput.value = str;
            tmInput.style.width = "99%";
            tmInput.style.height = "50vh";
            tmInput.id = "tminput";
            let info = document.createElement("p");
            info.innerHTML =
              "<em>NOTE: Tilemap must be square.</em><br></br>0 --> air <br></br> 1 --> tile <br></br> 2 --> double jump <br></br> 3 --> reset <br></br> 4 --> x2 speed <br></br> 5 --> finish <br></br> 6 --> spawn";
            info.style.color = "white";
            let setBtn = document.createElement("button");
            setBtn.innerHTML = "Save";
            setBtn.onclick = function () {
              let tilemap = JSON.parse(
                "[" + document.getElementById("tminput").value + "]"
              );
              going.up = false;
              going.right = false;
              going.left = false;
              tm = tilemap;
              for (var y = 0; y < tm.length; y++) {
                for (var x = 0; x < tm[y].length; x++) {
                  if (tm[y][x] == 6) {
                    playerxstart = x * 48;
                    playerystart = y * 48;
                  }
                }
              }
              player.x = playerxstart;
              player.y = playerystart;
              canvas.height = tm.length * 48;
              canvas.width = tm[0].length * 48;
            };
            interface.appendChild(tmInput);
            interface.appendChild(setBtn);
            interface.appendChild(info);
            document.body.appendChild(interface);
            return "'Developer Tools' has been revealed.";
          }
        }
      }
      canvas.height = tm.length * 48;
      canvas.width = tm[0].length * 48;
      for (var y = 0; y < tm.length; y++) {
        for (var x = 0; x < tm[y].length; x++) {
          if (tm[y][x] == 6) {
            var playerxstart = x * 48;
            var playerystart = y * 48;
          }
        }
      }
      var player = {
        y: playerystart,
        x: playerxstart,
        width: 33,
        height: 48,
        img: new Image()
      };
      var legs = {
        left: [player.x + 8, player.y + 40],
        right: [player.x + 32, player.y + 40],
      };
      var arms = {
        right: [player.x + 2, player.y + 21],
        left: [player.x + 46, player.y + 21],
      };
      var jumpBlock = false;
      var camx = 0;
      var camy = 0;
      var camwidth = disp.width / 2;
      var camheight = disp.height / 2;
      var speed = 4;
      var jumping = false;
      var playerOld = {
        x: player.x,
        y: player.y,
        width: player.width,
        height: player.height,
      };
      player.img.src =
        "https://cdn.glitch.global/1284e632-8cd2-44e5-8caa-58d0949e38ba/sprite1?v=1667116690938";
      var fps = 60;
      var now;
      var then = Date.now();
      var interval = 1000 / fps;
      var delta;
      function gameLoop() {
        requestAnimationFrame(gameLoop);

        now = Date.now();
        delta = now - then;
        if (delta >= interval) {
          disp.width = window.innerWidth * dispNum;
          disp.height = window.innerHeight;
          movingX = false;
          movingY = false;
          windtick++;
          if (windtick % 25 == 0) {
            windite++;
            if (windite >= winds.length) {
              windite = 0;
            }
            windimg = winds[windite];
          }
          camwidth = disp.width / 2;
          camheight = disp.height / 2;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "#DDCBDA";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          for (var y = 0; y < tm.length; y++) {
            for (var x = 0; x < tm[y].length; x++) {
              if (tm[y][x] == 1) {
                if (y != 0) {
                  if (y - 1 >= 0) {
                    if (tm[y - 1][x] != 1) {
                      ctx.drawImage(grass, x * 48, y * 48, 48, 48);
                    } else {
                      ctx.drawImage(dirt, x * 48, y * 48, 48, 48);
                    }
                  }
                } else {
                  ctx.drawImage(dirt, x * 48, y * 48, 48, 48);
                }
              }
              if (tm[y][x] == 2) {
                ctx.drawImage(jumpimg, x * 48, y * 48, 48, 48);
              }
              if (tm[y][x] == 3) {
                ctx.fillStyle = "#FF868D";
                ctx.fillRect(x * 48, y * 48, 48, 48);
              }
              if (tm[y][x] == 4) {
                ctx.drawImage(windimg, x * 48, y * 48, 48, 48);
              }
              if (tm[y][x] == 5) {
                ctx.drawImage(finish, x * 48, y * 48, 48, 48);
              }
              if (typeof tm[y][x] === "object") {
                if (tm[y][x].type == 7) {
                  ctx.drawImage(sign, x * 48, y * 48, 48, 48)
                }
              }
            }
          }
          let collide = collision();
          playerOld.x = player.x;
          playerOld.y = player.y;
          //fixing multijumpcollision
          if (onGround && tm[((player.y + player.height/2) - (player.y + player.height/2) % 48)/48 - 1][((player.x + player.width - 1) - (player.x + (player.width - 1)) % 48)/48] != 1 && tm[((player.y + player.height/2)- (player.y + player.height/2) % 48)/48 - 1][(player.x + 1- (player.x + 1) % 48)/48] != 1) {
            if (going.up == true) {
              jumpsustain = true
              jumping = true;
            }
          } else if (jumpBlock) {
            if (going.up == true) {
              jumpiter = 0;
              jumpSpeed = ogJumpSpeed;
              jumping = true;
              jumpsustain = true
            }
          }
          if (jumping && going.up && jumpsustain) {
            jumpHold++
          } else {
            jumpHold = 0
            jumpsustain = false
          }
          if (jumping == true) {
            movingY = true;
            jumpiter++
            player.y -= jumpSpeed
            if (jumpiter % Math.round(jumpSpeed * 3) == 0) {
              if (jumpHold > 10 && jumpHold < 35) {
                jumpSpeed = (jumpSpeed * jumpacc) * 1.9;
              } else {
                jumpSpeed *= jumpacc;
              }
              if (jumpSpeed <= jumpcap) {
                jumping = false;
              }
            }
          } else {
            jumpiter = 0;
            jumpSpeed = ogJumpSpeed;
          }
          collide = collision();
          if (collide[0]) {
            if (collide[1].type == 1) {
              player.y = playerOld.y;
              jumping = false;
              if (reverseGravity == true) {
                onGround = true;
              }
              let tile = collide[1];
              if (player.y > tile.y + 48) {
                player.y = tile.y + 48;
              }
            }
          }
          playerOld.x = player.x;
          playerOld.y = player.y;
          if (!onGround && !jumping) {
            movingY = true;
            graviter++;
            player.y += gravSpeed;
            if (graviter % Math.round(gravSpeed * 4) == 0) {
              gravSpeed *= gravacc;
              if (gravSpeed > gravcap) {
                gravSpeed = gravcap;
              }
            }
          } else {
            graviter = 0;
            gravSpeed = ogGravSpeed;
          }
          collide = collision();
          if (collide[0]) {
            if (collide[1].type == 1) {
              player.y = playerOld.y;
              let tile = collide[1];
              jumping = false;
              onGround = true;
              if (player.y + player.height < tile.y) {
                player.y = tile.y - player.height;
              }
            }
          } else {
            onGround = false;
          }
          playerOld.x = player.x;
          playerOld.y = player.y;
          if (going.left && !going.right) {
            right = false;
            movingX = true;
            player.x -= speed;
            collide = collision();
            if (collide[0]) {
              if (collide[1].type == 1) {
                player.x = playerOld.x;
                let tile = collide[1];
                if (player.x >= tile.x + 48) {
                  player.x = tile.x + 48;
                }
              }
            }
            playerOld.x = player.x;
            playerOld.y = player.y;
          }
          if (going.right && !going.left) {
            right = true;
            movingX = true;
            player.x += speed;
            collide = collision();
            if (collide[0]) {
              if (collide[1].type == 1) {
                player.x = playerOld.x;
                let tile = collide[1];
                if (player.x + player.width <= tile.x) {
                  player.x = tile.x - player.width;
                }
              }
            }
            playerOld.x = player.x;
            playerOld.y = player.y;
          }
          if (player.x < 0) {
            player.x = 0;
          }
          if (player.x > canvas.width - player.width) {
            player.x = canvas.width - player.width;
          }
          if (player.y < 0) {
            player.y = 0;
            jumping = false;
          }
          if (player.y > canvas.height - player.height) {
            player.y = canvas.height - player.height;
            onGround = true;
          }
          for (var i = 0; i < client_users.length; i++) {
            let client = client_users[i]
            ctx.globalAlpha = 0.5
            if (client.right == false) {
              let leg = {
                left: [client.x + 8, client.y + 40],
                right: [client.x + 20, client.y + 40],
              };
              let arm = {
                left: [client.x + 2, client.y + 33],
                right: [client.x + player.width - 6, client.y + 33],
              };
              
              ctx.fillStyle = "#b4f3ff";
              ctx.save();
              ctx.translate(arm.left[0] + 4, arm.left[1] + 3);
              ctx.rotate(client.legr * (Math.PI / 180));
              ctx.translate(-(arm.left[0] + 4), -(arm.left[1] + 3));
              ctx.fillRect(arm.left[0], arm.left[1], 4, 12);
              ctx.restore();
              ctx.fillStyle = "#24aac4";
              ctx.save();
              ctx.translate(leg.left[0] + 5, leg.left[1]);
              ctx.rotate(-client.legr * (Math.PI / 180));
              ctx.translate(-(leg.left[0] + 5), -leg.left[1]);
              ctx.fillRect(leg.left[0], leg.left[1], 5, 8);
              ctx.restore();

              ctx.save();
              ctx.translate(leg.right[0] + 3, leg.right[1]);
              ctx.rotate(client.legr * (Math.PI / 180));
              ctx.translate(-(leg.right[0] + 3), -leg.right[1]);
              ctx.fillRect(leg.right[0], leg.right[1], 5, 8);
              ctx.restore();
              ctx.fillStyle = "#b4f3ff";
              mirrorImage(player.img, client.x, client.y, true, false);
              ctx.save();
              ctx.translate(arm.right[0] + 2, arm.right[1] + 3);
              ctx.rotate(-client.legr * (Math.PI / 180));
              ctx.translate(-(arm.right[0] + 2), -(arm.right[1] + 3));
              ctx.fillRect(arm.right[0], arm.right[1], 4, 12);
              ctx.restore();
            } else {
              let leg = {
                left: [client.x + 8, client.y + 40],
                right: [client.x + 20, client.y + 40],
              };
              let arm = {
                left: [client.x + 2, client.y + 33],
                right: [client.x + player.width - 6, client.y + 33],
              };
              ctx.fillStyle = "#b4f3ff";
              ctx.save();
              ctx.translate(arm.right[0] + 1, arm.right[1] + 3);
              ctx.rotate(-client.legr * (Math.PI / 180));
              ctx.translate(-(arm.right[0] + 1), -(arm.right[1] + 3));
              ctx.fillRect(arm.right[0], arm.right[1], 4, 12);
              ctx.restore();
              ctx.fillStyle = "#24aac4";
              ctx.save();
              ctx.translate(leg.left[0] + 5, leg.left[1]);
              ctx.rotate(-client.legr * (Math.PI / 180));
              ctx.translate(-(leg.left[0] + 5), -leg.left[1]);
              ctx.fillRect(leg.left[0], leg.left[1], 5, 8);
              ctx.restore();

              ctx.save();
              ctx.translate(leg.right[0] + 3, leg.right[1]);
              ctx.rotate(client.legr * (Math.PI / 180));
              ctx.translate(-(leg.right[0] + 3), -leg.right[1]);
              ctx.fillRect(leg.right[0], leg.right[1], 5, 8);
              ctx.restore();
              ctx.fillStyle = "#b4f3ff";
              ctx.globalAlpha = 0.5
              ctx.drawImage(
                player.img,
                client.x,
                client.y,
                player.width,
                player.height
              );
              ctx.save();
              ctx.translate(arm.left[0] + 5, arm.left[1] + 3);
              ctx.rotate(client.legr * (Math.PI / 180));
              ctx.translate(-(arm.left[0] + 5), -(arm.left[1] + 3));
              ctx.fillRect(arm.left[0], arm.left[1], 4, 12);
              ctx.restore();
            }
            ctx.globalAlpha = 1
          }
          if (right == false) {
            legs = {
              left: [player.x + 8, player.y + 40],
              right: [player.x + 20, player.y + 40],
            };
            arms = {
              left: [player.x + 2, player.y + 33],
              right: [player.x + player.width - 6, player.y + 33],
            };
            ctx.fillStyle = "#b4f3ff";
            ctx.save();
            ctx.translate(arms.left[0] + 4, arms.left[1] + 3);
            ctx.rotate(legrotation * (Math.PI / 180));
            ctx.translate(-(arms.left[0] + 4), -(arms.left[1] + 3));
            ctx.fillRect(arms.left[0], arms.left[1], 4, 12);
            ctx.restore();
            ctx.fillStyle = "#24aac4";
            ctx.save();
            ctx.translate(legs.left[0] + 5, legs.left[1]);
            ctx.rotate(-legrotation * (Math.PI / 180));
            ctx.translate(-(legs.left[0] + 5), -legs.left[1]);
            ctx.fillRect(legs.left[0], legs.left[1], 5, 8);
            ctx.restore();

            ctx.save();
            ctx.translate(legs.right[0] + 3, legs.right[1]);
            ctx.rotate(legrotation * (Math.PI / 180));
            ctx.translate(-(legs.right[0] + 3), -legs.right[1]);
            ctx.fillRect(legs.right[0], legs.right[1], 5, 8);
            ctx.restore();
            ctx.fillStyle = "#b4f3ff";
            mirrorImage(player.img, player.x, player.y, true, false);
            ctx.save();
            ctx.translate(arms.right[0] + 2, arms.right[1] + 3);
            ctx.rotate(-legrotation * (Math.PI / 180));
            ctx.translate(-(arms.right[0] + 2), -(arms.right[1] + 3));
            ctx.fillRect(arms.right[0], arms.right[1], 4, 12);
            ctx.restore();
          } else {
            legs = {
              left: [player.x + 8, player.y + 40],
              right: [player.x + 20, player.y + 40],
            };
            arms = {
              left: [player.x + 2, player.y + 33],
              right: [player.x + player.width - 6, player.y + 33],
            };
            ctx.fillStyle = "#b4f3ff";
            ctx.save();
            ctx.translate(arms.right[0] + 1, arms.right[1] + 3);
            ctx.rotate(-legrotation * (Math.PI / 180));
            ctx.translate(-(arms.right[0] + 1), -(arms.right[1] + 3));
            ctx.fillRect(arms.right[0], arms.right[1], 4, 12);
            ctx.restore();
            ctx.fillStyle = "#24aac4";
            ctx.save();
            ctx.translate(legs.left[0] + 5, legs.left[1]);
            ctx.rotate(-legrotation * (Math.PI / 180));
            ctx.translate(-(legs.left[0] + 5), -legs.left[1]);
            ctx.fillRect(legs.left[0], legs.left[1], 5, 8);
            ctx.restore();

            ctx.save();
            ctx.translate(legs.right[0] + 3, legs.right[1]);
            ctx.rotate(legrotation * (Math.PI / 180));
            ctx.translate(-(legs.right[0] + 3), -legs.right[1]);
            ctx.fillRect(legs.right[0], legs.right[1], 5, 8);
            ctx.restore();
            ctx.fillStyle = "#b4f3ff";
            ctx.drawImage(
              player.img,
              player.x,
              player.y,
              player.width,
              player.height
            );
            ctx.save();
            ctx.translate(arms.left[0] + 5, arms.left[1] + 3);
            ctx.rotate(legrotation * (Math.PI / 180));
            ctx.translate(-(arms.left[0] + 5), -(arms.left[1] + 3));
            ctx.fillRect(arms.left[0], arms.left[1], 4, 12);
            ctx.restore();
          }
          legtick++;
          if ((going.right || going.left) && !(going.right && going.left)) {
            if (legCap) {
              legrotation -= speed;
              if (legrotation < -40) {
                legCap = false;
              }
            } else {
              legrotation += speed;
              if (legrotation > 40) {
                legCap = true;
              }
            }
          } else {
            legCap = false;
            if (Math.abs(legrotation) < speed) {
              legrotation = 0;
            }
            if (legrotation > 0) {
              legrotation -= speed;
            }
            if (legrotation < 0) {
              legrotation += speed;
            }
          }

          let camcen = { x: camx + camwidth / 2, y: camy + camheight / 2 };
          let playcen = { x: player.x + player.width/2, y: player.y + player.height/2 };
          let corndist = Math.sqrt(
            (camcen.x - camx) ** 2 + (camcen.y - camy) ** 2
          );
          let dist = Math.sqrt(
            (camcen.x - player.x) ** 2 + (camcen.y - player.y) ** 2
          );
          let ydist = Math.abs(playcen.y - camcen.y);
          let xdist = Math.abs(playcen.x - camcen.x);
          ///*
          if (playcen.x > camcen.x) {
            if (playcen.x - camcen.x < 2) {
              camcen.x = playcen.x;
            } else {
              if (speed > 3) {
                camx += (xdist / ((camwidth * 0.005) / (speed / 3))) * 0.05;
              } else {
                camx += (xdist / (camwidth * 0.005)) * 0.05;
              }
            }
          } else if (playcen.x < camcen.x) {
            if (camcen.x - playcen.x < 2) {
              camcen.x = playcen.x;
            } else {
              if (speed > 3) {
                camx -= (xdist / ((camwidth * 0.005) / (speed / 3))) * 0.05;
              } else {
                camx -= (xdist / (camwidth * 0.005)) * 0.05;
              }
            }
          }
          if (playcen.y > camcen.y) {
            if (playcen.y - camcen.y < 2) {
              camcen.y = playcen.y;
            } else {
              camy += (ydist / (camheight * 0.004)) * 0.05;
            }
          } else if (playcen.y < camcen.y) {
            if (camcen.y - playcen.y < 2) {
              camcen.y = playcen.y;
            } else {
              camy -= (ydist / (camheight * 0.004)) * 0.05;
            }
          }
          if (camx < 0) {
            camx = 0;
          }
          if (camx > canvas.width - camwidth) {
            camx = canvas.width - camwidth;
          }
          if (camy < 0) {
            camy = 0;
          }
          if (camy > canvas.height - camheight) {
            camy = canvas.height - camheight;
          }
          socket.emit("position", player.x, player.y, legrotation, right, window.location.pathname)
          dtx.clearRect(0, 0, disp.width, disp.height);
          dtx.drawImage(
            canvas,
            (sx = camx),
            (sy = camy),
            (sw = camwidth),
            (sh = camheight),
            (dx = 0),
            (dy = 0),
            (dw = disp.width),
            (dy = disp.height)
          );
          checkSign()
          if (signhover.active) {
            dtx.font = "bold 20px Monospace"
            let text = dtx.measureText(signhover.text)
            let width = text.width
            let lines = getLines(dtx, signhover.text, 500)
            height = 30
            for (var i = 0; i < lines.length; i++) {
              height += 20
            }
            dtx.fillStyle = "rgba(0, 0, 0, 0.7)"
            dtx.roundRect(disp.width/2 - width/2 - 10, disp.height - 20 - height, width + 20, height, 20).fill()
            dtx.fillStyle = "white"
            for (var i = 0; i < lines.length; i++) {
              dtx.fillText(lines[i], disp.width/2 - width/2, height - 25)
              height -= 20
            }
          }
          if (key) {
            dtx.fillStyle = "rgba(100, 100, 100, 0.8)";
            dtx.roundRect(disp.width - 210, 10, 200, 210, 10).fill();
            dtx.font = "bold 30px Arial";
            dtx.fillStyle = "#c48c6c";
            dtx.drawImage(grass, disp.width - 200, 20, 30, 30);
            dtx.fillText("Tile", disp.width - 160, 45);

            dtx.fillStyle = "#FF868D";
            dtx.fillRect(disp.width - 200, 60, 30, 30);
            dtx.fillText("Reset", disp.width - 160, 85);

            dtx.fillStyle = "rgb(100, 255, 100)";
            dtx.drawImage(jumpimg, disp.width - 200, 100, 30, 30);
            dtx.fillText("2x Jump", disp.width - 160, 125);

            dtx.fillStyle = "white";
            dtx.drawImage(windimg, disp.width - 200, 140, 30, 30);
            dtx.fillText("2x Speed", disp.width - 160, 165);

            dtx.fillStyle = "rgb(150, 150, 255)";
            dtx.drawImage(finish, disp.width - 200, 180, 30, 30);
            dtx.fillText("Finish", disp.width - 160, 205);
          } else {
            dtx.font = "bold 25px Arial";
            dtx.fillStyle = "rgba(125, 125, 125, 0.8)";
            dtx.fillText('Hold "Spacebar" for KEY', disp.width - 310, 30);
          }
          then = now - (delta % interval);
        }
      }
      gameLoop();
    </script>
  </body>
</html>